{"version":3,"sources":["../src/legend.js"],"names":["angular","_","kbn","$","module","directive","popoverSrv","$timeout","link","scope","elem","$container","firstRender","ctrl","panel","data","seriesList","i","events","on","series","color","sat","render","getSeriesIndexForElement","el","parents","toggleSeries","e","currentTarget","index","seriesInfo","openColorSelector","target","length","find","show","element","position","template","model","toggleAxis","colorSelected","changeSeriesColor","append","empty","legend","hideEmpty","allIsNull","html"],"mappings":"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","file":"legend.js","sourcesContent":["import angular from 'angular';\r\nimport _ from  'lodash';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport $ from  'jquery';\r\nimport 'jquery.flot';\r\nimport 'jquery.flot.time';\r\n\r\nangular.module('grafana.directives').directive('satmapLegend', function(popoverSrv, $timeout) {\r\n  return {\r\n    link: function(scope, elem) {\r\n      var $container = $('<section class=\"graph-legend\"></section>');\r\n      var firstRender = true;\r\n      var ctrl = scope.ctrl;\r\n      var panel = ctrl.panel;\r\n      var data;\r\n      var seriesList;\r\n      var i;\r\n\r\n      ctrl.events.on('render', function() {\r\n        data = ctrl.series;\r\n        if (data) {\r\n          for(var i in data) {\r\n            data[i].color = ctrl.data[i].color;\r\n            data[i].sat = ctrl.data[i].sat;\r\n          }\r\n          render();\r\n        }\r\n      });\r\n\r\n      function getSeriesIndexForElement(el) {\r\n        return el.parents('[data-series-index]').data('series-index');\r\n      }\r\n\r\n      function toggleSeries(e) {\r\n        var el = $(e.currentTarget);\r\n        var index = getSeriesIndexForElement(el);\r\n        var seriesInfo = seriesList[index];\r\n        ctrl.toggleSeries(seriesInfo, e);\r\n      }\r\n\r\n      function openColorSelector(e) {\r\n        // if we clicked inside poup container ignore click\r\n        if ($(e.target).parents('.popover').length) {\r\n          return;\r\n        }\r\n\r\n        var el = $(e.currentTarget).find('.fa-minus');\r\n        var index = getSeriesIndexForElement(el);\r\n        var series = seriesList[index];\r\n\r\n        $timeout(function() {\r\n          popoverSrv.show({\r\n            element: el[0],\r\n            position: 'bottom center',\r\n            template: '<gf-color-picker></gf-color-picker>',\r\n            model: {\r\n              series: series,\r\n              toggleAxis: function() {},\r\n              colorSelected: function(color) {\r\n                ctrl.changeSeriesColor(series, color);\r\n              }\r\n            },\r\n          });\r\n        });\r\n      }\r\n\r\n      function render() {\r\n        if (firstRender) {\r\n          elem.append($container);\r\n          $container.on('click', '.graph-legend-icon', openColorSelector);\r\n          $container.on('click', '.graph-legend-alias', toggleSeries);\r\n          firstRender = false;\r\n        }\r\n\r\n        seriesList = data;\r\n\r\n        $container.empty();\r\n\r\n        for (i = 0; i < seriesList.length; i++) {\r\n          var series = seriesList[i];\r\n\r\n          // ignore empty series\r\n          if (panel.legend.hideEmpty && series.allIsNull) {\r\n            continue;\r\n          }\r\n          // ignore series excluded via override\r\n          if (!series.legend) {\r\n            continue;\r\n          }\r\n\r\n          var html = '<div class=\"graph-legend-series';\r\n          html += '\" data-series-index=\"' + i + '\">';\r\n          html += '<span class=\"graph-legend-icon\" style=\"float:none;\">';\r\n          html += '<i class=\"fa fa-minus fa-rocket pointer\" style=\"color:' + series.color + '\"></i>';\r\n          html += '</span>';\r\n\r\n          html += '<span class=\"graph-legend-alias\" style=\"float:none;\">';\r\n          html += '<a>' + series.sat + '</a>';\r\n          html += '</span>';\r\n          html += '</div>';\r\n          $container.append($(html));\r\n        }\r\n      }\r\n    }\r\n  };\r\n});\r\n\r\n\r\n"]}